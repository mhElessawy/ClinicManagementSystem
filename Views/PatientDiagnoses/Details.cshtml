@model ClinicManagementSystem.Models.PatientDiagnosis
@{
    ViewData["Title"] = "تفاصيل التشخيص";
    var fileExtension = !string.IsNullOrEmpty(Model.DiagnosisFilePath) ? Path.GetExtension(Model.DiagnosisFilePath).ToLower() : "";
    var isImage = new[] { ".jpg", ".jpeg", ".png", ".gif", ".bmp" }.Contains(fileExtension);
    var isPdf = fileExtension == ".pdf";
}
<div class="row">
    <div class="col-md-12">
        <!-- Patient Information Card -->
        <div class="card mb-3">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-user"></i> معلومات المريض</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <strong>الاسم:</strong>
                        <p>@Model.Patient.PatientName</p>
                    </div>
                    <div class="col-md-3">
                        <strong>الرقم المدني:</strong>
                        <p>@(Model.Patient.PatientCivilID ?? "غير محدد")</p>
                    </div>
                    <div class="col-md-3">
                        <strong>هاتف 1:</strong>
                        <p>@(Model.Patient.PatientTel1 ?? "غير محدد")</p>
                    </div>
                    <div class="col-md-3">
                        <strong>هاتف 2:</strong>
                        <p>@(Model.Patient.PatientTel2 ?? "غير محدد")</p>
                    </div>
                    <div class="col-md-12">
                        <strong>العنوان:</strong>
                        <p>@(Model.Patient.PatientAddress ?? "غير محدد")</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Diagnosis Details Card -->
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0"><i class="fas fa-stethoscope"></i> @ViewData["Title"]</h4>
            </div>
            <div class="card-body">
                <dl class="row">
                    <dt class="col-sm-3">@Html.DisplayNameFor(model => model.Doctor)</dt>
                    <dd class="col-sm-9">
                        @if (Model.Doctor != null)
                        {
                            <span class="badge bg-primary">@Model.Doctor.DoctorName</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">غير محدد</span>
                        }
                    </dd>

                    <dt class="col-sm-3">@Html.DisplayNameFor(model => model.DiagnosisDate)</dt>
                    <dd class="col-sm-9">@Model.DiagnosisDate.ToString("yyyy-MM-dd")</dd>

                    <dt class="col-sm-3">@Html.DisplayNameFor(model => model.Active)</dt>
                    <dd class="col-sm-9">
                        @if (Model.Active)
                        {
                            <span class="badge bg-success">نشط</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">غير نشط</span>
                        }
                    </dd>

                    <dt class="col-sm-3">@Html.DisplayNameFor(model => model.DiagnosisDetails)</dt>
                    <dd class="col-sm-9">
                        <div class="border p-3 bg-light">
                            @Html.DisplayFor(model => model.DiagnosisDetails)
                        </div>
                    </dd>
                </dl>

                <div class="mt-4">
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning"><i class="fas fa-edit"></i> تعديل</a>
                    <a asp-action="Index" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> رجوع للقائمة</a>
                </div>
            </div>
        </div>

        <!-- File Viewer Card -->
        @if (!string.IsNullOrEmpty(Model.DiagnosisFilePath))
        {
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-file"></i> ملف التشخيص</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <a asp-action="GetDiagnosisFile" asp-route-id="@Model.Id" class="btn btn-sm btn-primary" download>
                            <i class="fas fa-download"></i> تحميل الملف
                        </a>
                    </div>

                    @if (isImage)
                    {
                        <div class="text-center">
                            <img src="@Model.DiagnosisFilePath" alt="Diagnosis File" class="img-fluid" style="max-height: 800px; border: 1px solid #ddd; border-radius: 4px; padding: 5px;" />
                        </div>
                    }
                    else if (isPdf)
                    {
                        <div class="embed-responsive" style="height: 800px;">
                            <iframe src="@Model.DiagnosisFilePath" width="100%" height="100%" style="border: 1px solid #ddd;">
                                <p>متصفحك لا يدعم عرض ملفات PDF. يمكنك <a asp-action="GetDiagnosisFile" asp-route-id="@Model.Id">تحميل الملف</a> بدلاً من ذلك.</p>
                            </iframe>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> نوع الملف غير مدعوم للعرض المباشر. يمكنك تحميل الملف لعرضه.
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>
